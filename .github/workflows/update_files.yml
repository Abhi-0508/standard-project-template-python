name: Update README and LICENSE

# ğŸš€ Trigger: Run this workflow on push to main branch
on:
  push:
    branches:
      - main

permissions:
  contents: write
  
jobs:
  update-files:
    # ğŸ–¥ï¸ Runner environment
    runs-on: ubuntu-latest

    steps:
      # ğŸ“¥ Step 1: Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # ğŸš¦ Step 2: Check if this is an automation commit to prevent loops
      - name: Prevent loop - skip if bot commit
        if: "${{ !startsWith(github.event.head_commit.message, 'Auto-update') }}"
        run: echo "âœ… Not a bot commit, proceeding."

      # ğŸ“ Step 3: Replace placeholders if they exist
      - name: Replace Placeholders
        if: "${{ !startsWith(github.event.head_commit.message, 'Auto-update') }}"
        run: |
          if grep -q '{{REPO_NAME}}' README.md; then
            echo "ğŸ” Placeholders found, replacing..."
            repo_name=$(basename $GITHUB_REPOSITORY)
            year=$(date +'%Y')
            author="Abhishek Radhakrishnan"

            sed -i "s/{{REPO_NAME}}/$repo_name/g" README.md
            sed -i "s/{{YEAR}}/$year/g" LICENSE
            sed -i "s/{{AUTHOR}}/$author/g" LICENSE
          else
            echo "âœ… No placeholders found, skipping replacement."
          fi

      # ğŸ’¾ Step 4: Stage and commit changes if any
      - name: Commit changes
        if: "${{ !startsWith(github.event.head_commit.message, 'Auto-update') }}"
        run: |
          git config --global user.name 'my-automation-actions[bot]'
          git config --global user.email 'my-automation-actions[bot]@noreply.com'

          # Stage modified files
          git add README.md LICENSE || echo "âœ… No files to add."

          # Check if there is anything to commit
          if git diff --cached --quiet; then
            echo "âœ… No changes to commit."
          else
            git commit -m "Auto-update README and LICENSE files with repository name, year and author information"
            git push
          fi
